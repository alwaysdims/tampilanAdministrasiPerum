<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Properti</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 2rem;
                box-sizing: border-box;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <main class="overflow-y-auto p-4 md:p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center mb-6">
                <div class="flex items-center justify-center w-12 h-12 bg-indigo-100 rounded-full mb-3">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9v2m0 0v2m0-2h2m-2 0h-2m2 0a2 2 0 11-4 0 2 2 0 014 0zM7 9v2m0 0v2m0-2h2m-2 0h-2m2 0a2 2 0 11-4 0 2 2 0 014 0zM12 9a2 2 0 100-4 2 2 0 000 4zM12 9h.01M12 12h.01M12 15h.01M12 18h.01M12 21a2 2 0 100-4 2 2 0 000 4z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800">Rp 125.000.000</h3>
                <p class="text-sm text-gray-500 mt-1">Total Pemasukan Hari Ini</p>
            </div>
        
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center mb-6">
                <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mb-3">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2a3 3 0 01-3-2c0-1.105 1.343-2 3-2zM12 8V7a2 2 0 012-2h4a2 2 0 012 2v10a2 2 0 01-2 2H8a2 2 0 01-2-2v-3.5"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800">Rp 750.000.000</h3>
                <p class="text-sm text-gray-500 mt-1">Total Pemasukan Bulan Ini</p>
            </div>
        
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center mb-6">
                <div class="flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mb-3">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l9-9 9 9M5 10v10a1 1 0 001 1h3m3 3h4a1 1 0 001-1v-4m-6-6v4m0 0h-4m4 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800">10 Unit</h3>
                <p class="text-sm text-gray-500 mt-1">Rumah Terjual Bulan Ini</p>
            </div>
        
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center mb-6">
                <div class="flex items-center justify-center w-12 h-12 bg-yellow-100 rounded-full mb-3">
                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2a3 3 0 01-3-2c0-1.105 1.343-2 3-2zM12 8V7a2 2 0 012-2h4a2 2 0 012 2v10a2 2 0 01-2 2H8a2 2 0 01-2-2v-3.5"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800">125</h3>
                <p class="text-sm text-gray-500 mt-1">Total Angsuran Aktif</p>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h5 class="text-xl font-bold text-gray-800 mb-4">Cetak Laporan Penjualan</h5>
            <div class="flex flex-col md:flex-row items-center gap-4">
                <div class="flex flex-col w-full">
                    <label for="start-date" class="text-sm font-medium text-gray-700">Tanggal Awal</label>
                    <input type="date" id="start-date" class="mt-1 p-2 w-full border border-gray-300 rounded-md">
                </div>
                <div class="flex flex-col w-full">
                    <label for="end-date" class="text-sm font-medium text-gray-700">Tanggal Akhir</label>
                    <input type="date" id="end-date" class="mt-1 p-2 w-full border border-gray-300 rounded-md">
                </div>
                <button id="print-button" class="w-full md:w-auto mt-6 md:mt-0 py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">
                    Cetak Laporan
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl shadow-lg p-2 flex flex-col items-center md:col-span-1">
                <h6 class="text-lg font-bold text-gray-800 mb-4 text-center">
                    Grafik Total Pemasukan Penjualan Rumah 5 Bulan ke Depan
                </h6>
                <div class="w-full h-64 sm:h-72 lg:h-96">
                    <canvas id="myChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 h-fit md:col-span-1">
                <h5 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-4">
                    ðŸ“Š Pemasukan Bulan Ini
                </h5>
                <div id="bulanIniCard" class="bg-green-50 rounded-lg p-4 border border-green-200 shadow-sm flex justify-between items-center">
                    </div>
            </div>
        </div>
    </main>
    
    <div id="print-area" class="hidden"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Data dummy untuk contoh transaksi
        const dummyTransactions = [
            { id: 1, date: '2025-07-15', amount: 500000000, type: 'Cash', property: 'Perumahan Indah Asri' },
            { id: 2, date: '2025-07-20', amount: 750000000, type: 'KPR', property: 'Cluster Griya Sejahtera' },
            { id: 3, date: '2025-08-01', amount: 125000000, type: 'Cash', property: 'Permata Hijau Residence' },
            { id: 4, date: '2025-08-05', amount: 450000000, type: 'Soft Cash', property: 'Griya Damai' },
            { id: 5, date: '2025-08-10', amount: 900000000, type: 'KPR', property: 'Nusa Indah Estate' },
            { id: 6, date: '2025-08-15', amount: 50000000, type: 'Soft Cash', property: 'Perumahan Indah Asri' },
            { id: 7, date: '2025-08-20', amount: 100000000, type: 'Cash', property: 'Cluster Griya Sejahtera' },
            { id: 8, date: '2025-08-22', amount: 30000000, type: 'Cash', property: 'Permata Hijau Residence' },
            { id: 9, date: '2025-08-24', amount: 20000000, type: 'Cash', property: 'Griya Damai' },
            // Tambahkan data dummy lainnya
        ];
        
        // Data dummy untuk grafik
        const dataChart = {
            labels: ['Juli', 'Agustus', 'September', 'Oktober', 'November'],
            datasets: [{
                label: 'Total Pemasukan (Rp)',
                data: [500000000, 750000000, 1200000000, 950000000, 1500000000],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        // Konfigurasi Chart.js
        const config = {
            type: 'line',
            data: dataChart,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                responsive: true,
                maintainAspectRatio: false
            }
        };

        // Inisialisasi Chart
        document.addEventListener('DOMContentLoaded', () => {
            const myChart = new Chart(
                document.getElementById('myChart'),
                config
            );
            renderBulanIniCard();
            setupPrintFeature();
        });
        
        // Fungsi untuk meng-handle card "Pemasukan Bulan Ini"
        function renderBulanIniCard() {
            const bulanIniCard = document.getElementById('bulanIniCard');
            const totalPemasukanBulanIni = dummyTransactions
                .filter(t => new Date(t.date).getMonth() === new Date().getMonth())
                .reduce((sum, t) => sum + t.amount, 0);
            
            bulanIniCard.innerHTML = `
                <span class="text-xl font-bold text-gray-800">
                    Rp ${totalPemasukanBulanIni.toLocaleString('id-ID')}
                </span>
                <span class="text-sm text-gray-500">
                    (${new Date().toLocaleString('id-ID', { month: 'long', year: 'numeric' })})
                </span>
            `;
        }

        // Fungsi untuk menyiapkan fitur cetak
        function setupPrintFeature() {
            const printBtn = document.getElementById('print-button');
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            printBtn.addEventListener('click', () => {
                const startDate = startDateInput.value ? new Date(startDateInput.value) : null;
                const endDate = endDateInput.value ? new Date(endDateInput.value) : null;
                
                if (!startDate || !endDate) {
                    alert('Mohon pilih tanggal awal dan tanggal akhir.');
                    return;
                }
                
                // Filter transaksi berdasarkan rentang tanggal
                const filteredTransactions = dummyTransactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate >= startDate && transactionDate <= endDate;
                });
                
                generateAndPrintReport(filteredTransactions, startDate, endDate);
            });
        }
        
        // Fungsi untuk membuat dan mencetak laporan
        function generateAndPrintReport(data, startDate, endDate) {
            const totalPemasukan = data.reduce((sum, t) => sum + t.amount, 0);
            const totalTerjual = data.length;
            
            let tableRows = '';
            if (data.length > 0) {
                data.forEach((t, index) => {
                    tableRows += `
                        <tr>
                            <td class="py-2 px-4 border-b">${index + 1}</td>
                            <td class="py-2 px-4 border-b">${t.property}</td>
                            <td class="py-2 px-4 border-b">${new Date(t.date).toLocaleDateString('id-ID')}</td>
                            <td class="py-2 px-4 border-b">Rp ${t.amount.toLocaleString('id-ID')}</td>
                            <td class="py-2 px-4 border-b">${t.type}</td>
                        </tr>
                    `;
                });
            } else {
                tableRows = `<tr><td colspan="5" class="py-2 px-4 text-center">Tidak ada transaksi dalam rentang tanggal ini.</td></tr>`;
            }
            
            const reportContent = `
                <div class="p-8">
                    <h1 class="text-2xl font-bold mb-2">Laporan Penjualan Rumah</h1>
                    <p class="text-lg text-gray-600 mb-6">Periode: ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}</p>
                    
                    <div class="mb-8 p-4 bg-gray-100 rounded-lg">
                        <p class="text-lg"><strong>Total Pemasukan:</strong> Rp ${totalPemasukan.toLocaleString('id-ID')}</p>
                        <p class="text-lg"><strong>Jumlah Rumah Terjual:</strong> ${totalTerjual} Unit</p>
                    </div>
                    
                    <h2 class="text-xl font-bold mb-4">Detail Transaksi</h2>
                    <table class="min-w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="py-2 px-4 border-b text-left">No</th>
                                <th class="py-2 px-4 border-b text-left">Nama Properti</th>
                                <th class="py-2 px-4 border-b text-left">Tanggal</th>
                                <th class="py-2 px-4 border-b text-left">Harga</th>
                                <th class="py-2 px-4 border-b text-left">Tipe Pembayaran</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                </div>
            `;
            
            // Masukkan konten ke area cetak dan cetak
            const printArea = document.getElementById('print-area');
            printArea.innerHTML = reportContent;
            
            window.print();
        }
    </script>
</body>
</html>